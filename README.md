Sprite/Texture Packer - Python 3

Pete Baron 18th April 2025

Generated by Claude with a series of refinement prompts (see footnotes).


REQUIRES:

```
Python 3.12.8
Pillow 11.2.1
```

USAGE:

PackerMulti.py <input_dir> <output_dir> [-h] [--max-width MAX_WIDTH] [--max-height MAX_HEIGHT] [--padding PADDING] [--prefix PREFIX] [--rotate] [--trim] [--placement {shortside,longside,area,bottomleft,optimal}]

Pack sprite frames into optimized sprite sheets


positional arguments:

  input_dir             Directory containing sprite frames

  output_dir            Directory to save sprite sheets and atlases


options:

  -h, --help            show this help message and exit

  --max-width WIDTH     Maximum width of sprite sheets

  --max-height HEIGHT   Maximum height of sprite sheets

  --padding PADDING     Padding between sprites

  --prefix PREFIX       Prefix for output files

  --rotate              Allow rotation of sprites by 90 degrees

  --trim                Trim transparent borders from sprites

  --placement {shortside,longside,area,bottomleft,optimal}
                        Placement heuristic to use (use "optimal" to try all and pick best)


// ATLAS FORMAT
```
{
  "frames": {
    "propeller.png": {
      "frame": {
        "x": 2,
        "y": 177,
        "w": 203,
        "h": 127
      },
      "rotated": true,
      "trimmed": true,
      "spriteSourceSize": {
        "x": 0,
        "y": -76,
        "w": 203,
        "h": 127
      },
      "sourceSize": {
        "w": 203,
        "h": 127
      }
    },
    "armored_steel_bubble_11.png": {
      "frame": {
        "x": 219,
        "y": 301,
        "w": 5,
        "h": 3
      },
      "rotated": true,
      "trimmed": true,
      "spriteSourceSize": {
        "x": 0,
        "y": -2,
        "w": 5,
        "h": 3
      },
      "sourceSize": {
        "w": 5,
        "h": 3
      }
    }
  },
  "meta": {
    "image": "sheet_0.png",
    "format": "RGBA8888",
    "size": {
      "w": 256,
      "h": 512
    },
    "scale": "1",
    "placement_heuristic": "shortside"
  }
}
```

CLAUDE PROMPTS:

"in python I want to make a program to create a tightly packed sprite sheet from a set of sprite frames. It will need a matching JSON atlas to say where each image is in the sprite sheet. The sprite sheet dimensions should be POT. If there are too many sprites for a single sheet of max 4096x4096 it should expand onto further sheets with separate atlases. Please consider carefully the best packing algorithm for 2d rectangles, and the best approach to extend onto multiple sheets, before starting to write any code."

"how long do we expect this to take with 76 sprites?"

"it has filled 32GB of RAM, and it's been running for 3 minutes so far. Does this sound reasonable? The images vary from approx 20 to 160 px in each dimension"

context limit approaching:
new conversation:

"this is a sprite packer, however when the number of sprites is small it ignores the specified dimensions. Can you fix it so it always pays attention to the parameters?"

"great that seems to be working perfectly. Now I'd like add a feature --rotate which allows the algorithm to rotate the sprites by multiples of 90 degrees when fitting them to the sheets. The rotation should be added to the json too"

"can you describe any further optimisations that will make the resulting sheets smaller?"

new conversation:

"this is sprite packing code, can you add whitespace trimming and the required json data to be able to offset the sprite when it has been trimmed?"

new conversation:

"Given the following sprite packer, can you implement as many of these optimisation as possible (ie. that will work together instead of against each other)?
1. Bin Packing Improvements
* Skyline Algorithm: Implement the Skyline algorithm as an alternative packing method, which can outperform MaxRects in certain scenarios by efficiently tracking the "skyline" of placed sprites.
* Multiple Placement Heuristics: Add more placement heuristics beyond "best short side fit" such as:
   * Best long side fit
   * Best area fit
   * Bottom-left placement
   * Allow switching between heuristics based on sprite characteristics
* Guillotine Splitting: Implement guillotine algorithm with various split heuristics (min-area, max-area, shortest-axis, longest-axis) as an alternative."

output tokens exceeded:

"continue"

output tokens exceeded:

"continue"

"this appears to be missing a main"

new conversation:

"this sprite packer appears to have an error with the main function being partially duplicated and broken, can you fix it?"

output tokens exceeded:

new conversation:

"this sprite packer has some errors, and it is too large. Can you reduce the size without losing functionality, and fix the problems (the problems are in 'main' there appears to be a duplication of some sort)?"

output tokens exceeded but not until after the code generation had completed and it was summarizing the work.

new conversation:

"this is the main function from a sprite packing script. Can you add an option to try all of the placement formats to find the most efficient one, then use that one for the final output?"

END OF CLAUDE PROMPTING.